<?php

namespace App\Http\Controllers;

use App\Models\ServiceRequests;
use App\StatusTimeline;
use Illuminate\Http\Request;

class ClosedRequestController extends Controller
{
    public function changeRequestStatus(Request $request)
    {

        $all_request =
        [   15532,15593,15716,16230,16252,16665,16666,16667,16695,16747,16851,17276,17532,17740,17795,17961,18357,18470,18544,18563,18565,18585,18605,18632,18649,18659,18663,18693,18696,18704,18747,18777,18778,18785,18819,18820,18821,18823,18824,18826,18829,18831,18832,18833,18834,18836,18838,18842,18845,18850,18851,18852,18853,18855,18856,18857,18858,18859,18860,18861,18862,18863,18884,18893,18965,18966,18969,18974,19033,19055,19059,19082,19107,19116,19117,19118,19120,19161,19166,19189,19191,19238,19374,19380,19404,19440,19555,19556,19605,19650,19673,19723,19743,19756,19761,19771,19774,19776,19795,19820,19833,19834,19850,19851,19880,19951,19965,19977,19991,20007,20086,20113,20153,20238,20250,20280,20290,20319,20372,20437,20450,20461,20466,20467,20479,20486,20496,20516,20581,20616,20714,20725,20734,20741,20751,20756,20814,20817,20850,20883,20884,20889,20890,20893,20951,20963,20985,21047,21199,21207,21208,21209,21210,21211,21226,21261,21273,21328,21331,21373,21399,21409,21414,21418,21426,21440,21458,21462,21491,21541,21543,21544,21552,21591,21609,21612,21653,21668,21671,21777,21841,21844,21849,21857,21863,21864,21866,21970,21976,21986,22001,22027,22050,22187,22216,22249,22258,22284,22285,22288,22339,22382,22445,22468,22488,22489,22501,22527,22530,22561,22568,22670,22672,22682,22692,22817,22846,22896,22898,22899,22907,22910,23014,23175,23207,23238,23264,23280,23329,23334,23339,23358,23374,23383,23389,23404,23410,23412,23471,23507,23530,23539,23553,23620,23624,23652,23733,23745,23765,23838,23868,23869,23870,23889,23891,23920,23946,24004,24006,24079,24083,24127,24132,24143,24151,24214,24223,24239,24244,24250,24254,24256,24258,24260,24261,24270,24275,24282,24294,24295,24309,24362,24412,24487,24493,24517,24526,24549,24580,24588,24599,24629,24638,24639,24640,24668,24721,24804,24808,24812,24817,24886,24907,24934,24947,24991,24994,25055,25066,25067,25083,25099,25120,25134,25135,25143,25155,25189,25206,25230,25325,25344,25362,25372,25383,25386,25509,25616,25671,25673,25679,25682,25745,25756,25770,25849,25850,25852,25853,25854,25893,25914,25986,25987,25988,26015,26018,26024,26030,26077,26094,26127,26128,26129,26134,26136,26174,26192,26201,26279,26303,26334,26351,26370,26398,26435,26436,26460,26473,26474,26507,26531,26564,26608,26613,26615,26618,26641,26661,26688,26721,26761,26770,26855,26859,26877,26914,27009,27021,27026,27065,27072,27101,27121,27130,27218,27248,27259,27273,27317,27363,27422,27430,27432,27441,27512,27570,27597,27602,27633,27635,27636,27661,27676,27686,27688,27693,27749,27755,27760,27791,27795,27857,27934,28023,28024,28033,28057,28058,28059,28060,28063,28064,28092,28158,28187,28211,28223,28230,28231,28259,28289,28292,28293,28294,28357,28384,28392,28407,28460,28476,28512,28515,28579,28622,28651,28656,28700,28703,28717,28718,28780,28809,28835,28846,28852,28853,28857,28862,28943,28946,28947,28965,28968,28969,28972,29015,29052,29057,29095,29112,29113,29145,29148,29161,29167,29213,29243,29265,29278,29298,29302,29340,29421,29427,29429,29436,29439,29467,29473,29485,29506,29540,29544,29545,29553,29582,29585,29635,29670,29674,29716,29767,29820,29839,29882,29887,29890,29910,29931,29944,29949,29953,29957,29959,29967,29969,30017,30020,30034,30070,30080,30088,30103,30154,30184,30192,30214,30219,30226,30246,30248,30287,30311,30328,30332,30345,30350,30354,30469,30520,30527,30528,30541,30586,30588,30658,30660,30682,30689,30703,30712,30718,30729,30770,30782,30785,30812,30819,30839,30847,30863,30879,30921,30959,30972,30994,30995,31012,31037,31057,31068,31070,31071,31089,31092,31124,31130,31156,31164,31178,31180,31202,31214,31255,31284,31299,31342,31343,31368,31369,31380,31397,31402,31421,31447,31454,31461,31462,31495,31496,31517,31523,31542,31589,31591,31631,31634,31649,31662,31706,31724,31732,31734,31740,31775,31801,31803,31811,31847,31876,31879,31911,31934,31955,31958,31963,31984,32008,32029,32044,32120,32184,32195,32245,32249,32256,32280,32295,32339,32340,32345,32346,32347,32364,32365,32366,32395,32400,32407,32413,32418,32426,32433,32438,32458,32472,32520,32531,32544,32565,32572,32593,32600,32605,32628,32657,32693,32703,32705,32715,32721,32724,32732,32752,32768,32785,32790,32845,32894,32907,32923,32943,32959,32981,32983,33040,33051,33077,33089,33096,33114,33118,33124,33145,33169,33189,33213,33231,33257,33290,33298,33299,33309,33318,33326,33328,33361,33363,33364,33365,33366,33379,33381,33383,33406,33407,33446,33447,33483,33541,33549,33562,33623,33665,33684,33711,33736,33741,33748,33760,33782,33783,33784,33791,33817,33854,33867,33870,33875,33889,33920,33925,33937,33958,33973,33992,34018,34038,34058,34067,34068,34116,34118,34129,34135,34142,34143,34150,34164,34180,34186,34194,34209,34223,34227,34228,34289,34385,34416,34418,34424,34440,34442,34443,34444,34445,34455,34474,34489,34529,34541,34559,34571,34572,34575,34578,34590,34651,34673,34676,34677,34685,34712,34723,34753,34758,34777,34841,34844,34893,34894,34900,34903,34928,34936,34939,34959,34982,35008,35022,35031,35041,35081,35082,35106,35147,35151,35157,35211,35220,35224,35241,35245,35308,35316,35338,35342,35361,35369,35396,35403,35404,35416,35420,35429,35445,35540,35574,35581,35584,35586,35590,35591,35630,35654,35683,35696,35708,35721,35765
        ];

        foreach($all_request as $all_requests){
            $servicerequest = ServiceRequests::where('id', $all_requests)->where('status', '!=', 'Closed')->first();

            if(!empty($servicerequest) || $servicerequest != null){
                Logger("Status Update ". $all_requests);
                ServiceRequests::where('id', $all_requests)->update([
                    'status' => "Closed"
                ]);

                $statu_check = StatusTimeline::where('request_id', $all_requests)->where('status', '!=', 'Closed')->first();

                if(!empty($statu_check) || $statu_check != null){
                    $status = new StatusTimeline;
                    $status->status = "Closed";
                    $status->customer_id = $servicerequest->customer_id;
                    $status->request_id = $servicerequest->id;
                    $status ->save();
                }
            }else{
                Logger("Status Not Update ". $all_requests);
            }
        }
        return "All Status Update";
    }
}
